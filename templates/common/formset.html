{% load bootstrap3 boilerplate %}
<div class="ibox float-e-margins">
    <div class="ibox-title">
        <h5>{{ formset|formset_model_name_plural }}</h5>
        {% include "common/ibox/tools.html" %}
    </div>
    <div class="ibox-content table-responsive collapse in" id="formset-{{ formset.prefix }}">
        {{ formset.management_form }}
        {{ formset.non_form_errors }}

        <table class="table table-striped table-condensed table-hover">
            <tbody>
                {% for form in formset %}
                    {% if forloop.first %}
                    <tr>
                        {% for field in form.visible_fields %}
                            {% if 'DELETE' not in field.name %}
                                <th>
                                    {% bootstrap_label field.label %}{% if field.help_text %} <abbr title="{{ field.help_text }}"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span></abbr>{% endif %}
                                </th>
                            {% elif formset.can_delete %}
                                <th class="text-center">
                                    {% if form.instance.pk %}{% bootstrap_label field.label %}{% endif %}
                                </th>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    {% endif %}
                    <tr class="form-row {% if form.instance.pk %}has_original{% endif %}" id="{{ formset.prefix }}-{{ forloop.counter }}">
                        <td class="original hide">
                            {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
                        </td>
                        {% for field in form.visible_fields %}
                            {% if 'DELETE' not in field.name %}
                            <td class="field-{{ field.label|slugify }} {% if field.errors %}bg-danger text-danger{% endif %}">
                                {% bootstrap_field field show_label=False size='sm' form_group_class='' %}
                            </td>
                            {% elif formset.can_delete %}
                                <td class="text-center">
                                    {% if form.instance.pk %}{{ field }}{% endif %}
                                </td>
                            {% endif %}
                        {% endfor %}
                    {% if form.non_field_errors %}
                        </tr>
                        <tr>
                            <td class="text-danger bg-danger" colspan="{{ form.visible_fields|length }}">
                                {% for err in form.non_field_errors %}
                                    {{ err }}
                                {% endfor %}
                            </td>
                    {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if forloop.last %}
			{% include 'common/form-buttons.html' %}
		{% endif %}
    </div>
</div>
